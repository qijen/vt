<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>vtPhysX: Angular Drives</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="online.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">PhysX for Virtools</a>&nbsp;&raquo&nbsp;<a class="el" href="guide.html">Guide</a>&nbsp;&raquo&nbsp;<a class="el" href="joint.html">Joint</a>&nbsp;&raquo&nbsp;<a class="el" href="d6joints.html">6DOF Joints</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="D6AngularDrivesGuide">Angular Drives </a></h1><h3>Angular Drives</h3>
<p>Angular drive differs from linear drive in a fundamental way: it does not have a simple and intuitive representation free from singularities. For this reason, the d6joint provides two angular drive models - twist and swing and SLERP (Spherical Linear Interpolation).</p>
<p>Twist and swing is intuitive in many situations; however, there is a singularity when driven to 180 degrees swing. In addition, the drive will not follow the shortest arc between two orientations.</p>
<p>On the other hand, SLERP drive will follow the shortest arc between a pair of angular configurations, but may cause un-intuitive changes in the joint's twist and swing.</p>
<p>The d6joint angular drive takes a quaternion as a target orientation. In a SLERP drive, the quaternion is used directly. In a twist and swing drive, it is decomposed into separate twist and swing components and each component is interpolated separately.</p>
<p><b>Angular Drive Model</b><br/>
</p>
<p>The angular drive model for the d6joint consists of the following parameters:</p>
<p>Velocity targets are specified in relation to the parent actor's (body[0]) frame using the following members of a D6:</p>
<ul>
<li>driveType - used to apply a type of drive with the following flags:<ul>
<li>D6DT_Position - Enable drive to a positional goal.</li>
<li>D6DT_Velocity - Enable drive to a velocity goal.</li>
</ul>
</li>
</ul>
<p>Separate drive descriptors for SLERP (slerpDrive), swing (swingDrive) and twist (twistDrive) can be specified using these D6 members:</p>
<ul>
<li>driveType - used to apply a type of drive with the following flags:<ul>
<li>D6DT_Position - Enable drive to a positional goal.</li>
<li>D6DT_Velocity - Enable drive to a velocity goal.</li>
</ul>
</li>
</ul>
<p>Angular orientation drive will attempt to follow the desired orientation input with the configured stiffness and damping properties, while the joint constraints are enforced by the solver. Ideally, the inputs should be consistent with the joint constraints, requiring more effort compared to the linear case.</p>
<p>The default drive behavior for the angular DOFs interpolates between orientations with decoupled twist and swing freedoms, using separate drive properties for twist and swing (both swing DOFs use the same drive properties). In fact, twist and swing is the only drive method for 1DOF or 2DOF angular joints when one or two angular DOFs are locked.</p>
<p>Instead of using the default twist and swing drive, 3DOF angular joints (i.e., no angular DOFs locked) with orientation drive can utilize the SLERP option that interpolates between orientations via a SLERP/shortest arc rotation.</p>
<hr/>
<p><b>1DOF Angular Drive</b><br/>
</p>
<p>A joint with a single angular DOF, i.e. a hinge or rotary joint, is similar to the equivalent linear 1DOF joint. The obvious coordinate in this case is the joint angle but here it must be input in quaternion form. The velocity input is the single angular velocity component for the selected DOF.</p>
<p>It is recommended that revolute joints are implemented as twist hinges because the d6joint is optimized for this case and provides slightly more flexible limit functionality. In other words, the user can specify a low and high angle separately, similar to the dedicated revolute joint.</p>
<p><span class="NiceCode"> </p>
<div class="fragment"><pre class="fragment"><a class="code" href="classp_joint.html" title="Abstract base class for the different types of joints.">pJoint</a> joint  = w.getJoint(a,b,<a class="code" href="group___joints.html#ggadcea5be96146723d822b7db05024d881a123db491acc937b6eb6c77531bef6552">JT_D6</a>);
<span class="keywordflow">if</span>(joint)
{
    <a class="code" href="classp_joint_d6.html" title="A D6 joint is a general constraint between two actors.">pJointD6</a> d6 = joint.castD6Joint();
    
    d6.<a class="code" href="classp_joint_d6.html#a06255644432722dc57ebd87bea8c717f" title="Sets the motion mode for the twist axis.">setTwistMotionMode</a>(<a class="code" href="group___d6.html#gga78bd37a3243af04c0ef86a19ffd70e88ab01e9c612e88a93f12fa57af51b10d53">D6MM_Free</a>);
    d6.<a class="code" href="classp_joint_d6.html#a85b531ab98652ee24b990baa75f45f26" title="Sets the motion mode for the swing1 axis.">setSwing1MotionMode</a>(<a class="code" href="group___d6.html#gga78bd37a3243af04c0ef86a19ffd70e88a6708a713a26006d7427c8d9050d8236d">D6MM_Locked</a>);
    d6.<a class="code" href="classp_joint_d6.html#a5c4b8950f0abee3e84b1a3b67e40cda2" title="Sets the motion mode for the swing2 axis.">setSwing2MotionMode</a>(<a class="code" href="group___d6.html#gga78bd37a3243af04c0ef86a19ffd70e88a6708a713a26006d7427c8d9050d8236d">D6MM_Locked</a>);
    
    
    <a class="code" href="classp_j_d6_drive.html" title="Class used to describe drive properties for a pJointD6.">pJD6Drive</a> twistDrive;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#ab59d2eeb15b6e352f57122929b215938">driveType</a>    = <a class="code" href="group___d6.html#ggaad3a2f6a45e027205242f80f11df0bd5a4c92a67fe52a5d25b15e7096e8cd30e5">D6DT_Position</a>;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#ab7fbe3ada7744cdedcf36fdb8dc9fe0a">forceLimit</a>   = 0.0f;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#af8bec735b464804a99069712ee260a8c">spring</a>       = 250.0f;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#a8ce5f11363b6b130edd4a17921351849">damping</a>      = 0.0f;
    
    d6.setTwistDrive(twistDrive);
    
    
    Quaternion quat;
    Vector rot( 1.0f , 0.0f , 0.0f );
    <span class="keywordtype">float</span> angle  = 45.0f;
    quat.FromRotation(rot,angle);
    
    d6.<a class="code" href="classp_joint_d6.html#a6666defe4434fea035ce3a451c249967" title="If the type of swingDrive or twistDrive is D6DT_Position, driveOrientation defines...">setDriveRotation</a>(quat);
}
</pre></div><p> </span> <br/>
</p>
<hr/>
<p><b>2DOF Angular Drive</b><br/>
</p>
<p>There are two types of joints with two angular DOFs: the zero-twist joint and the zero-swing joint.</p>
<p><em>zero-twist joint drive (aka Iso-Universal)</em> :</p>
<p>The two swing DOFs remain to be actuated.</p>
<p>The swing orientation is extracted from the input quaternion by decomposing it into twist and swing as shown at the end of this document, or it can be computed and input directly as shown here:</p>
<p>Qswing = Qyz = (Cyz, 0, Sy, Sz)Velocity inputs, if required, can be derived using the cross product to find the axis of rotation from the current twist-axis swing direction to its desired swing direction, as demonstrated below:</p>
<p><span class="NiceCode"> </p>
<div class="fragment"><pre class="fragment"><a class="code" href="classp_joint.html" title="Abstract base class for the different types of joints.">pJoint</a> joint  = w.getJoint(a,b,<a class="code" href="group___joints.html#ggadcea5be96146723d822b7db05024d881a123db491acc937b6eb6c77531bef6552">JT_D6</a>);
<span class="keywordflow">if</span>(joint)
{
    
    <a class="code" href="classp_joint_d6.html" title="A D6 joint is a general constraint between two actors.">pJointD6</a> d6 = joint.castD6Joint();
    
    
    d6.<a class="code" href="classp_joint_d6.html#a06255644432722dc57ebd87bea8c717f" title="Sets the motion mode for the twist axis.">setTwistMotionMode</a>(<a class="code" href="group___d6.html#gga78bd37a3243af04c0ef86a19ffd70e88a6708a713a26006d7427c8d9050d8236d">D6MM_Locked</a>);
    d6.<a class="code" href="classp_joint_d6.html#a85b531ab98652ee24b990baa75f45f26" title="Sets the motion mode for the swing1 axis.">setSwing1MotionMode</a>(<a class="code" href="group___d6.html#gga78bd37a3243af04c0ef86a19ffd70e88ab01e9c612e88a93f12fa57af51b10d53">D6MM_Free</a>);
    d6.<a class="code" href="classp_joint_d6.html#a5c4b8950f0abee3e84b1a3b67e40cda2" title="Sets the motion mode for the swing2 axis.">setSwing2MotionMode</a>(<a class="code" href="group___d6.html#gga78bd37a3243af04c0ef86a19ffd70e88ab01e9c612e88a93f12fa57af51b10d53">D6MM_Free</a>);
    
    
    <a class="code" href="classp_j_d6_drive.html" title="Class used to describe drive properties for a pJointD6.">pJD6Drive</a> twistDrive;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#ab59d2eeb15b6e352f57122929b215938">driveType</a>    = <a class="code" href="group___d6.html#ggaad3a2f6a45e027205242f80f11df0bd5a4c92a67fe52a5d25b15e7096e8cd30e5">D6DT_Position</a>;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#ab7fbe3ada7744cdedcf36fdb8dc9fe0a">forceLimit</a>   = 0.0f;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#af8bec735b464804a99069712ee260a8c">spring</a>       = 250.0f;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#a8ce5f11363b6b130edd4a17921351849">damping</a>      = 0.01f;
    
    d6.setTwistDrive(twistDrive);
    
    
    Quaternion quat;
    Vector rot( 1.0f , 0.0f , 0.0f );
    <span class="keywordtype">float</span> angle  = 45.0f;
    quat.FromRotation(rot,angle);
    
    d6.<a class="code" href="classp_joint_d6.html#a6666defe4434fea035ce3a451c249967" title="If the type of swingDrive or twistDrive is D6DT_Position, driveOrientation defines...">setDriveRotation</a>(quat);
    
}
</pre></div><p> </span> <br/>
</p>
<p><em>zero-swing joint drive (aka Universal)</em> :</p>
<p>The 2DOFs are a pair of sequential rotations about orthogonal axes:</p>
<ul>
<li>The zero-swing1 joint DOFs are rotations about the child x-axis and the parent z-axis.</li>
<li>The zero-swing2 joint DOFs are rotations about the child x-axis and the parent y-axis.</li>
</ul>
<p>The joint constraint keeps the two rotation axes orthogonal.</p>
<p>The input quaternion is computed by composing the two rotations (e.g., for the zero-swing2 joint):</p>
<p>QyQx = (Cy, 0, Sy, 0)(Cx, Sx, 0, 0) = (CyCx, CySx, SyCx, -SySx)The angular velocity input vector is found by adding two rotation-axis-aligned angular velocity vectors as shown below:</p>
<p><span class="NiceCode"> </p>
<div class="fragment"><pre class="fragment"><a class="code" href="classp_joint.html" title="Abstract base class for the different types of joints.">pJoint</a> joint  = w.getJoint(a,b,<a class="code" href="group___joints.html#ggadcea5be96146723d822b7db05024d881a123db491acc937b6eb6c77531bef6552">JT_D6</a>);
<span class="keywordflow">if</span>(joint)
{
    
    <a class="code" href="classp_joint_d6.html" title="A D6 joint is a general constraint between two actors.">pJointD6</a> d6 = joint.castD6Joint();
    
    
    d6.<a class="code" href="classp_joint_d6.html#a06255644432722dc57ebd87bea8c717f" title="Sets the motion mode for the twist axis.">setTwistMotionMode</a>(<a class="code" href="group___d6.html#gga78bd37a3243af04c0ef86a19ffd70e88ab01e9c612e88a93f12fa57af51b10d53">D6MM_Free</a>);
    d6.<a class="code" href="classp_joint_d6.html#a85b531ab98652ee24b990baa75f45f26" title="Sets the motion mode for the swing1 axis.">setSwing1MotionMode</a>(<a class="code" href="group___d6.html#gga78bd37a3243af04c0ef86a19ffd70e88a6708a713a26006d7427c8d9050d8236d">D6MM_Locked</a>);
    d6.<a class="code" href="classp_joint_d6.html#a5c4b8950f0abee3e84b1a3b67e40cda2" title="Sets the motion mode for the swing2 axis.">setSwing2MotionMode</a>(<a class="code" href="group___d6.html#gga78bd37a3243af04c0ef86a19ffd70e88ab01e9c612e88a93f12fa57af51b10d53">D6MM_Free</a>);
    
    
    <a class="code" href="classp_j_d6_drive.html" title="Class used to describe drive properties for a pJointD6.">pJD6Drive</a> twistDrive;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#ab59d2eeb15b6e352f57122929b215938">driveType</a>    = <a class="code" href="group___d6.html#ggaad3a2f6a45e027205242f80f11df0bd5a4c92a67fe52a5d25b15e7096e8cd30e5">D6DT_Position</a>;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#ab7fbe3ada7744cdedcf36fdb8dc9fe0a">forceLimit</a>   = 0.0f;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#af8bec735b464804a99069712ee260a8c">spring</a>       = 250.0f;
    twistDrive.<a class="code" href="classp_j_d6_drive.html#a8ce5f11363b6b130edd4a17921351849">damping</a>      = 0.01f;
    
    d6.setTwistDrive(twistDrive);
    
    
    <a class="code" href="classp_j_d6_drive.html" title="Class used to describe drive properties for a pJointD6.">pJD6Drive</a> swingDrive;
    swingDrive.<a class="code" href="classp_j_d6_drive.html#ab59d2eeb15b6e352f57122929b215938">driveType</a>    = <a class="code" href="group___d6.html#ggaad3a2f6a45e027205242f80f11df0bd5a4c92a67fe52a5d25b15e7096e8cd30e5">D6DT_Position</a>;
    swingDrive.<a class="code" href="classp_j_d6_drive.html#ab7fbe3ada7744cdedcf36fdb8dc9fe0a">forceLimit</a>   = 0.0f;
    swingDrive.<a class="code" href="classp_j_d6_drive.html#af8bec735b464804a99069712ee260a8c">spring</a>       = 250.0f;
    swingDrive.<a class="code" href="classp_j_d6_drive.html#a8ce5f11363b6b130edd4a17921351849">damping</a>      = 0.01f;
    
    d6.setSwingDrive(swingDrive);

    
    
    Quaternion targetOri;
    
    <span class="comment">//...</span>
    
    d6.<a class="code" href="classp_joint_d6.html#a6666defe4434fea035ce3a451c249967" title="If the type of swingDrive or twistDrive is D6DT_Position, driveOrientation defines...">setDriveRotation</a>(targetOri);
    
}
</pre></div><p> </span> <br/>
</p>
<hr/>
<p><b>3DOF Angular Drive</b><br/>
</p>
<p>The non-integrable ('nonholonomic') behavior manifests itself in joints with 3DOF (i.e., none of the angular DOFs are locked).</p>
<p>Pure angular velocity drive is useless for actuating the orientation of a body in the full 3DOFs as the orientation will quickly drift away from what might be expected.</p>
<p>For an orientation drive, there is a choice between the default twist and swing drive or the optional SLERP drive.</p>
<p><b>twist and swing drive</b><br/>
</p>
<p>Internally, the angular drive defaults to using twist and swing coordinates. This is the preferred choice for all joints within a skeletal character because it gives the expected interpolation behavior, decoupling twist and swing freedoms. However, many animation systems deal with quaternions and perform SLERPs or LERPs between the quaternions representing individual key frames. In these systems, the SLERP drive may be the preferred system as it most closely mimics the interpolation used in the key framing system.</p>
<p>Another case where the twist and swing drive may prove useful is with AI controlled objects, such as gun turrents, where the natural parameterization of the joint is a twist and a swing.</p>
<p>The twist and swing drive acts on the absolute coordinates between parent frame and child frame, attempting to bring these coordinates to the desired values between parent frame and drive frame.</p>
<p>Because it acts on absolute coordinates, the child frame should not be driven near the twist and swing singularity at a full 180 degree swing.</p>
<p><b>SLERP drive</b><br/>
</p>
<p>The d6joint angular drive has a SLERP option to replace the default drive. The SLERP option decouples twist and swing coordinates with an isotropic drive of all three angular DOFs. This uses rotation vector coordinates in which a rotation vector lies in the single shortest rotation axis so the 3D rotation isn't being decomposed into a sequence of rotations as with twist and swing.</p>
<p>The SLERP drive acts locally between the drive frame and the child frame. The parent frame is not directly involved in the drive behavior; it only acts as a root from which to specify the drive frame offset.</p>
<p>Because it acts locally, the SLERP option is useful when the child object can rotate to any arbitrary orientation relative to the parent without limit.</p>
<p>There is a singularity that could cause the child to get stuck if its frame is 180 degrees away from the drive frame, but this is unlikely to occur (and will correct itself with any small disturbance).</p>
<p><span class="NiceCode"> </p>
<div class="fragment"><pre class="fragment"><a class="code" href="classp_joint.html" title="Abstract base class for the different types of joints.">pJoint</a> joint  = w.getJoint(a,b,<a class="code" href="group___joints.html#ggadcea5be96146723d822b7db05024d881a123db491acc937b6eb6c77531bef6552">JT_D6</a>);
<span class="keywordflow">if</span>(joint)
{
    
    <a class="code" href="classp_joint_d6.html" title="A D6 joint is a general constraint between two actors.">pJointD6</a> d6 = joint.castD6Joint();
    
    
    <a class="code" href="classp_j_d6_drive.html" title="Class used to describe drive properties for a pJointD6.">pJD6Drive</a> slerpDrive;
    slerpDrive.<a class="code" href="classp_j_d6_drive.html#ab59d2eeb15b6e352f57122929b215938">driveType</a>    = <a class="code" href="group___d6.html#ggaad3a2f6a45e027205242f80f11df0bd5a4c92a67fe52a5d25b15e7096e8cd30e5">D6DT_Position</a>;
    slerpDrive.<a class="code" href="classp_j_d6_drive.html#ab7fbe3ada7744cdedcf36fdb8dc9fe0a">forceLimit</a>   = 0.0f;
    slerpDrive.<a class="code" href="classp_j_d6_drive.html#af8bec735b464804a99069712ee260a8c">spring</a>       = 250.0f;
    slerpDrive.<a class="code" href="classp_j_d6_drive.html#a8ce5f11363b6b130edd4a17921351849">damping</a>      = 0.01f;
    
    d6.setTwistDrive(slerpDrive);
    
    Quaternion animTarget;
    
    <span class="comment">//...</span>
    d6.<a class="code" href="classp_joint_d6.html#a6666defe4434fea035ce3a451c249967" title="If the type of swingDrive or twistDrive is D6DT_Position, driveOrientation defines...">setDriveRotation</a>(animTarget);
    
}
        
</pre></div><p> </span> <br/>
 </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Feb 3 18:57:23 2010 for vtPhysX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
